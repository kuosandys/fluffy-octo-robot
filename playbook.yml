---
- hosts: local
  vars:
    brew_sh:
      - bat
      - exa
      - git
      - go # this is removed in the gvm installation task
      - python3
      - yarn
    brew_gui:
      - 1password
      - calibre
      - discord
      - figma
      - firefox-developer-edition
      - goland
      - iterm2
      - postman
      - rectangle
      - slack
      - spotify
      - typora
      - vlc
      - visual-studio-code
  tasks:
    - name: Install utils with brew
      homebrew: name={{ item }} state=present
      with_items: '{{ brew_sh }}'

    - name: Tap homebrew casks of drivers
      homebrew_tap: homebrew/cask-drivers

    - name: Tap homebrew casks of alternate versions
      homebrew_tap: homebrew/cask-versions

    - name: Install GUI apps with brew
      homebrew_cask: name={{ item }} state=present
      with_items: '{{ brew_gui }}'

    - name: Configure mac system settings
      script: ./scripts/configure-mac.sh

    - name: Install oh-my-zsh
      shell: sh -c "$(curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"

    - name: Install p10k
      git:
        repo: https://github.com/romkatv/powerlevel10k.git
        dest: ~/.oh-my-zsh/custom/themes/powerlevel10k
        clone: yes

    - name: Install zsh syntax highlighting
      git:
        repo: https://github.com/zsh-users/zsh-syntax-highlighting.git
        dest: ~/.oh-my-zsh/custom/plugins/zsh-syntax-highlighting
        clone: yes

    - name: Install zsh auto-suggestions
      git:
        repo: https://github.com/zsh-users/zsh-autosuggestions
        dest: ~/.oh-my-zsh/custom/plugins/zsh-autosuggestions
        clone: yes

    - name: Copy config files
      copy:
        src: ./config/dotfiles/
        dest: ~/

    - name: Copy font files
      copy:
        src: ./config/fonts/
        dest: ~/Library/Fonts/

    - name: Install nvm and latest node
      shell: |
        curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.1/install.sh | bash
        source ~/.nvm/nvm.sh
        nvm install node
        nvm use node
        nvm alias default node

    - name: Install gvm and go1.18
      shell: |
        zsh -c "$(curl -s -S -L https://raw.githubusercontent.com/moovweb/gvm/master/binscripts/gvm-installer)"
        gvm install go1.18
        gvm use go1.18 --default
        brew uninstall go
